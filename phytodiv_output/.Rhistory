{
trait.df<-data.frame()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
trait.df=merge(df,trait.df)
return(trait.df)
}
rimov<-mfg.to.traits.df1(rimov)
rimov<-mfg.to.traits.1(rimov)
mfg.to.traits.df1<-function(df) #must have column named MFG.num
{
trait.df<-data.frame()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
trait.df=merge(df,trait.df)
return(trait.df)
}
rimov<-mfg.to.traits.df1(rimov)
mfg.to.traits.df1()
mfg.to.traits.df1
debugSource('~/gleon/Geisha/phyto_package/USGS_gitlab/mfg_to_traits.r', echo=TRUE)
##code to output a trait matrix based on salmaso MFG classification
##matrix is currently incomplete, and is only the inverse of information contained in salmaso et al. 2015 supplemental table 2
## could be expanded by indicating the expected trait values for individual classes/orders, based on the literature
mfg.to.traits.1<-function(MFG.num)
{
trait.df<-switch(MFG.num,
'1a' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'1b' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'1c' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2a' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2b' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2c' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2d' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'3a' = data.frame(flagella = 1, autotroph = 1, size = NA, colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'3b' = data.frame(flagella = 1, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'4' = data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5a' = data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5b' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = NA, gelatinous = NA, aerotopes = 1, filamentous = NA),
'5c' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = NA, gelatinous = NA, aerotopes = 0, filamentous = NA),
'5d' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5e' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6a1' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6a2' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6b1' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6b2' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'7a' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = NA, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'7b' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = NA, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'8a' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'8b' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9a' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9b' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9c' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9d' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'10a'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'10b'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'10c'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'11a'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = 0, aerotopes = NA, filamentous = 0),
'11b'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = 1, aerotopes = NA, filamentous = 0),
'11c'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 0)
)
trait.df$MFG.num=MFG.num
return(trait.df)
}
mfg.to.traits.df1<-function(df) #must have column named MFG.num
{
trait.df<-data.frame()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
trait.df=merge(df,trait.df)
return(trait.df)
}
rimov<-mfg.to.traits.df1(rimov)
df=rimov
trait.df<-data.frame()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
dim(df)
mfg.to.traits.1(df$MFG.num[1])
trait.df<-vector()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
trait.df<-vector()
for(i in 1:dim(df)[1])
{
print(mfg.to.traits.1(df$MFG.num[i]))
}
mfg.to.traits.1<-function(MFG.num)
{
trait.df<-switch(MFG.num,
'1a' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'1b' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'1c' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2a' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2b' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2c' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2d' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'3a' = data.frame(flagella = 1, autotroph = 1, size = NA, colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'3b' = data.frame(flagella = 1, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'4' = data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5a' = data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5b' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = NA, gelatinous = NA, aerotopes = 1, filamentous = NA),
'5c' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = NA, gelatinous = NA, aerotopes = 0, filamentous = NA),
'5d' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5e' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6a1' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6a2' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6b1' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6b2' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'7a' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = NA, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'7b' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = NA, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'8a' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'8b' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9a' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9b' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9c' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9d' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'10a'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'10b'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'10c'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'11a'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = 0, aerotopes = NA, filamentous = 0),
'11b'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = 1, aerotopes = NA, filamentous = 0),
'11c'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 0),
NA= data.frame(flagella = NA, autotroph = NA, size = NA, colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA)
)
trait.df$MFG.num=MFG.num
return(trait.df)
}
if(is.na(MFG.num)){
trait.df=data.frame(flagella = NA, autotroph = NA, size = NA, colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA)
}
mfg.to.traits.1<-function(MFG.num)
{
trait.df<-switch(MFG.num,
'1a' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'1b' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'1c' = data.frame(flagella = 1, autotroph = 0, size = 'Large', colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2a' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2b' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2c' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'2d' = data.frame(flagella = 1, autotroph = 0, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'3a' = data.frame(flagella = 1, autotroph = 1, size = NA, colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'3b' = data.frame(flagella = 1, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'4' = data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5a' = data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5b' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = NA, gelatinous = NA, aerotopes = 1, filamentous = NA),
'5c' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = NA, gelatinous = NA, aerotopes = 0, filamentous = NA),
'5d' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'5e' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6a1' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6a2' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6b1' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 1, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'6b2' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'7a' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = NA, centric = 1, gelatinous = NA, aerotopes = NA, filamentous = NA),
'7b' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = NA, centric = 0, gelatinous = NA, aerotopes = NA, filamentous = NA),
'8a' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'8b' = data.frame(flagella = 0, autotroph = 1, size = 'Large', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9a' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9b' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9c' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'9d' = data.frame(flagella = 0, autotroph = 1, size = 'Small', colonial = 0, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA),
'10a'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'10b'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'10c'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 1),
'11a'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = 0, aerotopes = NA, filamentous = 0),
'11b'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = 1, aerotopes = NA, filamentous = 0),
'11c'= data.frame(flagella = 0, autotroph = 1, size = NA, colonial = 1, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = 0)
)
if(is.na(MFG.num)){
trait.df=data.frame(flagella = NA, autotroph = NA, size = NA, colonial = NA, centric = NA, gelatinous = NA, aerotopes = NA, filamentous = NA)
}
trait.df$MFG.num=MFG.num
return(trait.df)
}
mfg.to.traits.df1<-function(df) #must have column named MFG.num
{
trait.df<-vector()
for(i in 1:dim(df)[1])
{
print(mfg.to.traits.1(df$MFG.num[i]))
}
trait.df=merge(df,trait.df)
return(trait.df)
}
trait.df<-vector()
for(i in 1:dim(df)[1])
{
print(mfg.to.traits.1(df$MFG.num[i]))
}
rbind(table(is.na(rimov$MFG)),table(is.na(rimov$MFG))/dim(rimov)[1])
rimov.missings=rimov$phyto_name[is.na(rimov$MFG)]
rimov<-mfg.to.traits.df1(rimov)
mfg.to.traits.df1<-function(df) #must have column named MFG.num
{
trait.df<-vector()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
trait.df=merge(df,trait.df)
return(trait.df)
}
rimov=read.csv('rimov/SpeciesList_Rimov_QAQC_07Sep2017.csv')
rimov<-genus.species.extract(rimov,'phyto_name')
rimov<-phyto.convert.df(rimov)
rimov$MFG.num=sapply(rimov$MFG,function(x) strsplit(x,split='-')[[1]][1])
rimov<-mfg.csr.convert.df(rimov,'MFG.num')
rimov<-mfg.to.traits.df1(rimov)
setwd('~/gleon/Geisha/datasets/rawphytodata/phytodata_qaqc/')
#############################################################
rimov=read.csv('rimov/SpeciesList_Rimov_QAQC_07Sep2017.csv')
rimov<-genus.species.extract(rimov,'phyto_name')
rimov<-phyto.convert.df(rimov)
rimov$MFG.num=sapply(rimov$MFG,function(x) strsplit(x,split='-')[[1]][1])
rimov<-mfg.csr.convert.df(rimov,'MFG.num')
rimov<-mfg.to.traits.df1(rimov)
setwd('~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/')
source('mfg_to_traits_03252018.R')
load('sppMFG.rda')
load('MFG_CSR.rda')
rimov=read.csv('rimov/SpeciesList_Rimov_QAQC_07Sep2017.csv')
rimov<-genus.species.extract(rimov,'phyto_name')
rimov<-phyto.convert.df(rimov)
rimov$MFG.num=sapply(rimov$MFG,function(x) strsplit(x,split='-')[[1]][1])
rimov<-mfg.csr.convert.df(rimov,'MFG.num')
rimov<-mfg.to.traits.df1(rimov)
head(rimov)
setwd('~/gleon/Geisha/datasets/rawphytodata/phytodata_qaqc/')
#############################################################
rimov=read.csv('rimov/SpeciesList_Rimov_QAQC_07Sep2017.csv')
rimov<-genus.species.extract(rimov,'phyto_name')
rimov<-phyto.convert.df(rimov)
rimov$MFG.num=sapply(rimov$MFG,function(x) strsplit(x,split='-')[[1]][1])
rimov<-mfg.csr.convert.df(rimov,'MFG.num')
dim(rimov)
mfg.to.traits.df1(rimov)
df=rimov
trait.df<-vector()
i=1
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
trait.df
names(df)
trait.df=trait.df[!duplicated(trait.df),]
trait.df=merge(df,trait.df)
trait.df<-vector()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
trait.df=trait.df[!duplicated(trait.df),]
trait.df=merge(df,trait.df)
return(trait.df)
dim(Trait.df)
dim(trait.df)
mfg.to.traits.df1<-function(df) #must have column named MFG.num
{
trait.df<-vector()
for(i in 1:dim(df)[1])
{
trait.df=rbind(trait.df,mfg.to.traits.1(df$MFG.num[i]))
}
trait.df=trait.df[!duplicated(trait.df),]
trait.df=merge(df,trait.df)
return(trait.df)
}
rimov=read.csv('rimov/SpeciesList_Rimov_QAQC_07Sep2017.csv')
rimov<-genus.species.extract(rimov,'phyto_name')
rimov<-phyto.convert.df(rimov)
rimov$MFG.num=sapply(rimov$MFG,function(x) strsplit(x,split='-')[[1]][1])
rimov<-mfg.csr.convert.df(rimov,'MFG.num')
rimov<-mfg.to.traits.df1(rimov)
rbind(table(is.na(rimov$MFG)),table(is.na(rimov$MFG))/dim(rimov)[1])
rimov.missings=rimov$phyto_name[is.na(rimov$MFG)]
head(rimov)
write.csv('~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/')
write.csv(rimov,'~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/rimov_phytodiv.csv',row.names = F,quote=F)
cheney=read.csv('Cheney/SpeciesList_Cheney_QAQC_15Sep2017.csv')
cheney<-genus.species.extract(cheney,'Algaebase_Current_15Sep2017')
cheney<-phyto.convert.df(cheney)
cheney$MFG.num=sapply(cheney$MFG,function(x) strsplit(x,split='-')[[1]][1])
cheney<-mfg.csr.convert.df(cheney,'MFG.num')
cheney<-mfg.to.traits.df1(cheney)
rbind(table(is.na(cheney$MFG)),table(is.na(cheney$MFG))/dim(cheney)[1])
Chascomus=read.csv('Chascomus/SpeciesList_Chascomus_QAQC_02Sep2017.csv')
Chascomus<-genus.species.extract(Chascomus,'Algaebase_Current_21Aug2017')
Chascomus<-phyto.convert.df(Chascomus)
Chascomus$MFG.num=sapply(Chascomus$MFG,function(x) strsplit(x,split='-')[[1]][1])
Chascomus<-mfg.csr.convert.df(Chascomus,'MFG.num')
Chascomus<-mfg.to.traits.df1(Chascomus)
rbind(table(is.na(Chascomus$MFG)),table(is.na(Chascomus$MFG))/dim(Chascomus)[1])
write.csv(Chascomus,'~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/Chascomus_phytodiv.csv',row.names = F,quote=F)
species.mfg.library
dim(species.mfg.library)
Chascomus[is.na(Chascomus$MFG),]
rbind(table(is.na(Chascomus$MFG)),table(is.na(Chascomus$MFG))/dim(Chascomus)[1])
14/(83+19)
Chascomus.na=Chascomus[is.na(Chascomus$MFG),]
Chascomus.na<-genus.species.extract(Chascomus.na,'phyto_name')
Chascomus.na$MFG
vortsjarv<-phyto.convert.df(vortsjarv)
vortsjarv=read.csv('vortsjarv/SpeciesList_vortsjarv_QAQC_21Aug2017.csv')
vortsjarv<-genus.species.extract(vortsjarv,'Algaebase_Current_7Aug2017')
vortsjarv<-phyto.convert.df(vortsjarv)
vortsjarv$MFG.num=sapply(vortsjarv$MFG,function(x) strsplit(x,split='-')[[1]][1])
vortsjarv<-mfg.csr.convert.df(vortsjarv,'MFG.num')
vortsjarv<-mfg.to.traits.df1(vortsjarv)
rbind(table(is.na(vortsjarv$MFG)),table(is.na(vortsjarv$MFG))/dim(vortsjarv)[1])
write.csv(vortsjarv,'~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/vortsjarv_phytodiv.csv',row.names = F,quote=F)
vortsjarv[is.na(vortsjarv$NA),]
vortsjarv[is.na(vortsjarv$MFG),]
rbind(table(is.na(vortsjarv$MFG)),table(is.na(vortsjarv$MFG))/dim(vortsjarv)[1])
16/(158+25)
kasumigara=read.csv('kasumigara/SpeciesList_Kasumigaura_QAQC_17Aug2017.csv')
kasumigara<-genus.species.extract(kasumigara,'Algaebase_Current_17Aug2017')
kasumigara<-phyto.convert.df(kasumigara)
kasumigara$MFG.num=sapply(kasumigara$MFG,function(x) strsplit(x,split='-')[[1]][1])
kasumigara<-mfg.csr.convert.df(kasumigara,'MFG.num')
kasumigara<-mfg.to.traits.df1(kasumigara)
rbind(table(is.na(kasumigara$MFG)),table(is.na(kasumigara$MFG))/dim(kasumigara)[1])
write.csv(kasumigara,'~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/kasumigara_phytodiv.csv',row.names = F,quote=F)
dir()
maggiore=read.csv('./muggelsee/SpeciesList_Muggelsee_QAQC_31Aug2017.csv')
maggiore<-genus.species.extract(maggiore,'Algaebase_Current_31Aug2017')
muggelsee=read.csv('./muggelsee/SpeciesList_Muggelsee_QAQC_31Aug2017.csv')
muggelsee<-genus.species.extract(muggelsee,'Algaebase_Current_31Aug2017')
names(muggelsee)
muggelsee<-genus.species.extract(muggelsee,'Algaebase_Current_14Aug2017')
muggelsee<-phyto.convert.df(muggelsee)
muggelsee$MFG.num=sapply(muggelsee$MFG,function(x) strsplit(x,split='-')[[1]][1])
muggelsee<-mfg.csr.convert.df(muggelsee,'MFG.num')
muggelsee<-mfg.to.traits.df1(muggelsee)
rbind(table(is.na(muggelsee$MFG)),table(is.na(muggelsee$MFG))/dim(muggelsee)[1])
write.csv(muggelsee,'~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/muggelsee_phytodiv.csv',row.names = F,quote=F)
windermere<-genus.species.extract(windermere,'Algaebase_Current_14Aug2017')
windermere=read.csv('./windermere/SpeciesList_Windermere_QAQC_22Sep2017.csv')
names(windermere)
windermere<-genus.species.extract(windermere,'Algaebase_Current_22Sep2017')
windermere<-phyto.convert.df(windermere)
windermere$MFG.num=sapply(windermere$MFG,function(x) strsplit(x,split='-')[[1]][1])
windermere<-mfg.csr.convert.df(windermere,'MFG.num')
windermere<-mfg.to.traits.df1(windermere)
rbind(table(is.na(windermere$MFG)),table(is.na(windermere$MFG))/dim(windermere)[1])
write.csv(windermere,'~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/windermere_phytodiv.csv',row.names = F,quote=F)
windermere[is.na(windermere$MFG),]
rbind(table(is.na(windermere$MFG)),table(is.na(windermere$MFG))/dim(windermere)[1])
69-26
43/(283+69)
43/(283+43)
names(windermere)
windermere.biovol<-read.csv('windermere/RawPhytoData_Windermere_QAQC_22Sep2017_CELL.csv')
head(windermere.biovol)
windermere.biovol$biomass_ug_l
na.omit(windermere.biovol$biomass_ug_l)
windermere.biovol$biomass_ug_l
windermere.biovol$biovol_um3_ml
vortsjarv.biomass<-read.csv('vortsjarv/RawPhytoData_Vortsjarv_QAQC_21Aug2017.csv')
head(vortsjarv.biomass)
df[[date]]=as.POSIXct(df[[date]],format='%m-%d-%y')
df=vortsjarv
date='date_dd_mm_yy'
df[[date]]=as.POSIXct(df[[date]],format='%m-%d-%y')
df$date_dd_mm_yy=as.POSIXct(df$date_dd_mm_yy,format='%m-%d-%y')
df=vortsjarv
df
names(df)
df=vortsjarv.biomass
df$date_dd_mm_yy=as.POSIXct(df$date_dd_mm_yy,format='%m-%d-%y')
head(df)
table(df$date,df$stationid)
?aggregate
biomass.mfg.date.agg=function(df)
{
df$date_dd_mm_yy=as.POSIXct(df$date_dd_mm_yy,format='%m-%d-%y')
df.agg=aggregate(df$biomass_ug_l,by=list(df$date_dd_mm_yy,df$MFG),sum)
return(df.agg)
}
biomass.mfg.date(vortsjarv.biomass)
biomass.mfg.date.agg(vortsjarv.biomass)
rimov.biovol.agg<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
library(Reol)
library(taxize)
setwd('~/gleon/Geisha/Datasets/rawphytodata/')
rimov<-read.csv('RawPhytoDatabySize_Rimov_QAQC_07Sep2017.csv')
rimov<-genus.species.extract(rimov,'phyto_name')
rimov<-phyto.convert.df(rimov)
rimov$MFG.number=sapply(rimov$MFG,function(x)strsplit(x,split='-')[[1]][1])
rimov<-mfg.csr.convert.df(rimov)
rimov$CSR[rimov$CSR=='C-R']='CR'
rimov$CSR=factor(rimov$CSR)
rimov.biovol.agg=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+CSR,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg<-aggregate(biovol_um3_ml~date+CSR,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
rimov.biovol.agg2<-aggregate(biovol_um3_ml~date_dd_mm_yy+stationid,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg2$date=as.POSIXct(rimov.biovol.agg2$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg2<-aggregate(biovol_um3_ml~date,data=rimov.biovol.agg2,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg2<-rimov.biovol.agg2[order(rimov.biovol.agg2$date),]
setwd('~/gleon/Geisha/Datasets/rawphytodata/')
rimov<-read.csv('RawPhytoDatabySize_Rimov_QAQC_07Sep2017.csv')
setwd('~/gleon/Geisha/Datasets/rawphytodata/')
rimov<-read.csv('PhytoMFG_Rimov_QAQC14Nov2017.csv')
rimov.biovol.agg=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+CSR,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg<-aggregate(biovol_um3_ml~date+CSR,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
rimov.biovol.agg2<-aggregate(biovol_um3_ml~date_dd_mm_yy+stationid,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg2$date=as.POSIXct(rimov.biovol.agg2$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg2<-aggregate(biovol_um3_ml~date,data=rimov.biovol.agg2,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg2<-rimov.biovol.agg2[order(rimov.biovol.agg2$date),]
rimov.biovol.agg2
rimov.biovol.agg3$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
rimov.biovol.agg3=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+MFG,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg3$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
names(rimov.biovol.agg3)
head(rimov.biovol.agg3)
rimov.biovol.agg3$date=as.POSIXct(as.character(rimov.biovol.agg$date_dd_mm_yy),format='%d-%m-%y')
rimov.biovol.agg3$date=as.POSIXct(as.character(rimov.biovol.agg3$date_dd_mm_yy),format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg3,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
head(rimov.biovol.agg3)
ggplot()_geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG))
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG))
library(ggplot2)
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG))
names(rimov.biovol.agg3
)
rimov.biovol.agg3=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+MFG,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg3$date=as.POSIXct(as.character(rimov.biovol.agg3$date_dd_mm_yy),format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg3,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
rimov.biovol.agg3<-rimov.biovol.agg3[order(rimov.biovol.agg3$date),]
library(ggplot2)
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG))
names(rimov.biovol.agg3)
rimov.biovol.agg3=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+MFG,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg3$date=as.POSIXct(as.character(rimov.biovol.agg3$date_dd_mm_yy),format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg3,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-rimov.biovol.agg3[order(rimov.biovol.agg3$date),]
names(rimov.biovol.agg3)
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG))
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG))+stat_count('identity')
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG,stat_count('identity')))
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG),stat_count('identity'))
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG),geom_stat('identity'))
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,group=MFG),stat='identity')
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,color=MFG),stat='identity')
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,fill=MFG),stat='identity')
rimov$MFG[is.na(rimov$MFG)]='unknown'
rimov$MFG[is.na(rimov$MFG)]='unknown'
?names(rimov)
names(rimov)
str(rimov)
rimov$MFG=as.character(rimov$MFG)
rimov$MFG[is.na(rimov$MFG)]='unknown'
rimov.biovol.agg3=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+MFG,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg3$date=as.POSIXct(as.character(rimov.biovol.agg3$date_dd_mm_yy),format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg3,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-rimov.biovol.agg3[order(rimov.biovol.agg3$date),]
library(ggplot2)
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,fill=MFG),stat='identity')
rimov$MFG=as.character(rimov$MFG)
rimov$MFG[is.na(rimov$MFG)]='unknown'
rimov.biovol.agg=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+CSR,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg<-aggregate(biovol_um3_ml~date+CSR,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
rimov.biovol.agg2<-aggregate(biovol_um3_ml~date_dd_mm_yy+stationid,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg2$date=as.POSIXct(rimov.biovol.agg2$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg2<-aggregate(biovol_um3_ml~date,data=rimov.biovol.agg2,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg2<-rimov.biovol.agg2[order(rimov.biovol.agg2$date),]
rimov.biovol.agg3=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+MFG,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg3$date=as.POSIXct(as.character(rimov.biovol.agg3$date_dd_mm_yy),format='%d-%m-%y')
rimov.biovol.agg3<-aggregate(biovol_um3_ml~date+MFG,data=rimov.biovol.agg3,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg3<-rimov.biovol.agg3[order(rimov.biovol.agg3$date),]
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,fill=CSR),stat='identity')
ggplot()+geom_bar(data=rimov.biovol.agg,aes(x=date,y=biovol_um3_ml,fill=CSR),stat='identity')
rimov$CSR[is.na(rimov$CSR)]='unknown'
rimov$MFG=as.character(rimov$MFG)
rimov$CSR=as.character(rimov$CSR)
rimov$MFG[is.na(rimov$MFG)]='unknown'
rimov$CSR[is.na(rimov$CSR)]='unknown'
rimov.biovol.agg=aggregate(biovol_um3_ml~date_dd_mm_yy+stationid+CSR,data=rimov,FUN=function(x) sum(na.omit(x)))
rimov.biovol.agg$date=as.POSIXct(rimov.biovol.agg$date_dd_mm_yy,format='%d-%m-%y')
rimov.biovol.agg<-aggregate(biovol_um3_ml~date+CSR,data=rimov.biovol.agg,FUN=function(x) mean(na.omit(x)))
rimov.biovol.agg<-rimov.biovol.agg[order(rimov.biovol.agg$date),]
ggplot()+geom_bar(data=rimov.biovol.agg,aes(x=date,y=biovol_um3_ml,fill=CSR),stat='identity')
setwd('~/gleon/Geisha/phyto_package/GEISHA_phytoplankton_github_shared/phytodiv_output/')
write.csv(rimov.biovol.agg2,'rimov_totalbiovolume_timeseries.csv')
write.csv(rimov.biovol.agg,'rimov_csr_biovolume_timeseries.csv')
write.csv(rimov.biovol.agg3,'rimov_mfg_biovolume_timeseries.csv')
write.csv(rimov.biovol.agg3,'rimov_mfg_biovolume_timeseries.csv')
ggplot()+geom_bar(data=rimov.biovol.agg3,aes(x=date,y=biovol_um3_ml,fill=MFG),stat='identity')
